version: 2
jobs:
  build:
    working_directory: ~/cardshuffler
    docker:
      - image: conanio/gcc8
    steps:
      - checkout
      - run:
          name: "Install build dependencies"
          command: "pip -q install --user --upgrade conan"
      - run:
          name: "Setup Conan"
          command: "conan user;
            conan profile new --detect --force default;
            conan profile update settings.compiler.libcxx=libstdc++11 default"
      - run:
          name: "Build Environment"
          command: "gcc --version;
            g++ --version;
            cmake --version;
            conan --version;"
      - run:
          name: "Install Conan Packages"
          command: "mkdir build;
          cd build;
          conan install .. --build=missing"
      - run:
          name: "CMake"
          command: "cd build;
          cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -G Ninja .."
      - run:
          name: "Build"
          command: "cmake --build build/ --target all"
      - run:
          name: "Test"
          command: "cmake --build build --target test"
      - store_test_results:
          path: build/tests/results


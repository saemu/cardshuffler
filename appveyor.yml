---
version: 1.0.{build}

image:
  - Visual Studio 2019

environment:
  matrix:
    - configuration: "Debug"
      env_script: "C:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Auxiliary/Build/vcvars64.bat"
      runtime: "MDd"
    - configuration: "Release"
      env_script: "C:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Auxiliary/Build/vcvars64.bat"
      runtime: "MD"

install:
  - set PATH=%PYTHON%/Scripts/;%PATH%
  - pip.exe install conan --upgrade
  - conan user
  - mkdir build
  - cd build

build_script:
  - call "%env_script%"
  - set PATH=%PYTHON%/Scripts/;%PATH%
  - conan install .. --settings build_type=%configuration% --settings compiler.runtime=%runtime% --build=missing
  - cmake ../ -G "Ninja" -DCMAKE_BUILD_TYPE=%configuration%
  - cmake --build . --config %configuration%

test_script:
  - ctest -C %configuration%
